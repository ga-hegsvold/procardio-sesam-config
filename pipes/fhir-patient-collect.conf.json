{
  "_id": "fhir-patient-collect",
  "type": "pipe",
  "source": {
    "type": "conditional",
    "alternatives": {
      "dev": {
        "type": "embedded",
        "entities": [{
          "name": [{
            "family": "Chalmers",
            "given": ["Peter", "James"],
            "use": "official"
          }, {
            "given": ["Jim"],
            "use": "usual"
          }, {
            "family": "Windsor",
            "given": ["Peter", "James"],
            "period": {
              "end": "2002"
            },
            "use": "maiden"
          }],
          "_birthDate": {
            "extension": [{
              "url": "http://hl7.org/fhir/StructureDefinition/patient-birthTime",
              "valueDateTime": "1974-12-25T14:35:45-05:00"
            }]
          },
          "active": true,
          "address": [{
            "type": "both",
            "city": "PleasantVille",
            "district": "Rainbow",
            "line": ["534 Erewhon St"],
            "period": {
              "start": "1974-12-25"
            },
            "postalCode": "3999",
            "state": "Vic",
            "text": "534 Erewhon St PeasantVille, Rainbow, Vic  3999",
            "use": "home"
          }],
          "birthDate": "1974-12-25",
          "contact": [{
            "name": {
              "_family": {
                "extension": [{
                  "url": "http://hl7.org/fhir/StructureDefinition/humanname-own-prefix",
                  "valueString": "VV"
                }]
              },
              "family": "du Marché",
              "given": ["Bénédicte"]
            },
            "address": {
              "type": "both",
              "city": "PleasantVille",
              "district": "Rainbow",
              "line": ["534 Erewhon St"],
              "period": {
                "start": "1974-12-25"
              },
              "postalCode": "3999",
              "state": "Vic",
              "use": "home"
            },
            "gender": "female",
            "period": {
              "start": "2012"
            },
            "relationship": [{
              "coding": [{
                "system": "http://terminology.hl7.org/CodeSystem/v2-0131",
                "code": "N"
              }]
            }],
            "telecom": [{
              "system": "phone",
              "value": "+33 (237) 998327"
            }]
          }],
          "deceasedBoolean": false,
          "gender": "male",
          "id": "example",
          "identifier": [{
            "type": {
              "coding": [{
                "system": "http://terminology.hl7.org/CodeSystem/v2-0203",
                "code": "MR"
              }]
            },
            "system": "urn:oid:1.2.36.146.595.217.0.1",
            "assigner": {
              "display": "Acme Healthcare"
            },
            "period": {
              "start": "2001-05-06"
            },
            "use": "usual",
            "value": "12345"
          }],
          "managingOrganization": {
            "reference": "Organization/1"
          },
          "meta": {
            "tag": [{
              "system": "http://terminology.hl7.org/CodeSystem/v3-ActReason",
              "code": "HTEST",
              "display": "test health data"
            }]
          },
          "resourceType": "Patient",
          "telecom": [{
            "use": "home"
          }, {
            "system": "phone",
            "rank": 1,
            "use": "work",
            "value": "(03) 5555 6473"
          }, {
            "system": "phone",
            "rank": 2,
            "use": "mobile",
            "value": "(03) 3410 5613"
          }, {
            "system": "phone",
            "period": {
              "end": "2014"
            },
            "use": "old",
            "value": "(03) 5555 8834"
          }],
          "text": {
            "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\"><p style=\"border: 1px #661aff solid; background-color: #e6e6ff; padding: 10px;\"><b>Jim </b> male, DoB: 1974-12-25 ( Medical record number: 12345 (use: USUAL, period: 2001-05-06 --&gt; (ongoing)))</p><hr/><table class=\"grid\"><tr><td style=\"background-color: #f3f5da\" title=\"Record is active\">Active:</td><td>true</td><td style=\"background-color: #f3f5da\" title=\"Known status of Patient\">Deceased:</td><td colspan=\"3\">false</td></tr><tr><td style=\"background-color: #f3f5da\" title=\"Alternate names (see the one above)\">Alt Names:</td><td colspan=\"3\"><ul><li>Peter James Chalmers (OFFICIAL)</li><li>Peter James Windsor (MAIDEN)</li></ul></td></tr><tr><td style=\"background-color: #f3f5da\" title=\"Ways to contact the Patient\">Contact Details:</td><td colspan=\"3\"><ul><li>-unknown-(HOME)</li><li>ph: (03) 5555 6473(WORK)</li><li>ph: (03) 3410 5613(MOBILE)</li><li>ph: (03) 5555 8834(OLD)</li><li>534 Erewhon St PeasantVille, Rainbow, Vic  3999(HOME)</li></ul></td></tr><tr><td style=\"background-color: #f3f5da\" title=\"Nominated Contact: Next-of-Kin\">Next-of-Kin:</td><td colspan=\"3\"><ul><li>Bénédicte du Marché  (female)</li><li>534 Erewhon St PleasantVille Vic 3999 (HOME)</li><li><a href=\"tel:+33(237)998327\">+33 (237) 998327</a></li><li>Valid Period: 2012 --&gt; (ongoing)</li></ul></td></tr><tr><td style=\"background-color: #f3f5da\" title=\"Patient Links\">Links:</td><td colspan=\"3\"><ul><li>Managing Organization: <a href=\"organization-example-gastro.html\">Organization/1</a> &quot;Gastroenterology&quot;</li></ul></td></tr></table></div>",
            "status": "generated"
          }
        }, {
          "name": [{
            "family": "MINT_TEST"
          }],
          "_gender": {
            "extension": [{
              "url": "http://nema.org/examples/extensions#gender",
              "valueCoding": {
                "system": "http://nema.org/examples/gender",
                "code": "M"
              }
            }]
          },
          "active": true,
          "extension": [{
            "url": "http://nema.org/fhir/extensions#0010:1010",
            "valueQuantity": {
              "unit": "Y",
              "value": 56
            }
          }, {
            "url": "http://nema.org/fhir/extensions#0010:1020",
            "valueQuantity": {
              "unit": "m",
              "value": "~f1.83"
            }
          }, {
            "url": "http://nema.org/fhir/extensions#0010:1030",
            "valueQuantity": {
              "unit": "kg",
              "value": "~f72.58"
            }
          }],
          "gender": "male",
          "id": "dicom",
          "identifier": [{
            "system": "http://nema.org/examples/patients",
            "value": "MINT1234"
          }],
          "managingOrganization": {
            "reference": "Organization/1"
          },
          "meta": {
            "tag": [{
              "system": "http://terminology.hl7.org/CodeSystem/v3-ActReason",
              "code": "HTEST",
              "display": "test health data"
            }]
          },
          "resourceType": "Patient",
          "text": {
            "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\"> Patient MINT_TEST, ID = MINT1234. Age = 56y, Size =\n      1.83m, Weight = 72.58kg </div>",
            "status": "generated"
          }
        }],
        "if_source_empty": "accept"
      }
    },
    "condition": "$ENV(node-env)"
  },
  "transform": {
    "type": "dtl",
    "rules": {
      "default": [
        ["copy", "*"],
        ["add", "_id", "_S.id"]
      ]
    }
  },
  "metadata": {
    "tags": ["fhir", "collect"]
  },
  "remove_namespaces": true
}
