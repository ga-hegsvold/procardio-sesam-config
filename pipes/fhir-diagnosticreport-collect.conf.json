{
  "_id": "fhir-diagnosticreport-collect",
  "type": "pipe",
  "source": {
    "type": "conditional",
    "alternatives": {
      "dev": {
        "type": "embedded",
        "entities": [{
          "category": [{
            "coding": [{
              "system": "http://snomed.info/sct",
              "code": "394914008",
              "display": "Radiology"
            }, {
              "system": "http://terminology.hl7.org/CodeSystem/v2-0074",
              "code": "RAD"
            }]
          }],
          "code": {
            "coding": [{
              "system": "http://snomed.info/sct",
              "code": "45036003",
              "display": "Ultrasonography of abdomen"
            }],
            "text": "Abdominal Ultrasound"
          },
          "conclusion": "Unremarkable study",
          "effectiveDateTime": "2012-12-01T12:00:00+01:00",
          "id": "ultrasound",
          "issued": "2012-12-01T12:00:00+01:00",
          "media": [{
            "comment": "A comment about the image",
            "link": {
              "display": "WADO example image",
              "reference": "DocumentReference/1.2.840.11361907579238403408700.3.1.04.19970327150033"
            }
          }],
          "meta": {
            "tag": [{
              "system": "http://terminology.hl7.org/CodeSystem/v3-ActReason",
              "code": "HTEST",
              "display": "test health data"
            }]
          },
          "performer": [{
            "reference": "Practitioner/example"
          }],
          "resourceType": "DiagnosticReport",
          "status": "final",
          "subject": {
            "reference": "Patient/example"
          },
          "text": {
            "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\"><h2><span title=\"Codes: {http://snomed.info/sct 45036003}\">Abdominal Ultrasound</span> (<span title=\"Codes: {http://snomed.info/sct 394914008}, {http://terminology.hl7.org/CodeSystem/v2-0074 RAD}\">Radiology</span>) </h2><table class=\"grid\"><tr><td>Subject</td><td><b>Jim </b> male, DoB: 1974-12-25 ( Medical record number: 12345 (use: USUAL, period: 2001-05-06 --&gt; (ongoing)))</td></tr><tr><td>When For</td><td>2012-12-01T12:00:00+01:00</td></tr><tr><td>Reported</td><td>2012-12-01T12:00:00+01:00</td></tr></table><p><b>Report Details</b></p><div><p>Unremarkable study</p>\n</div></div>",
            "status": "generated"
          }
        }],
        "if_source_empty": "accept"
      }
    },
    "condition": "$ENV(node-env)"
  },
  "transform": {
    "type": "dtl",
    "rules": {
      "default": [
        ["copy", "*"],
        ["add", "_id", "_S.id"]
      ]
    }
  },
  "metadata": {
    "tags": ["fhir", "collect"]
  },
  "remove_namespaces": true
}
